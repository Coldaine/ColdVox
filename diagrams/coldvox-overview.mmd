%%{init: {"theme": "base","themeVariables": {"primaryColor":"#f4f4f4","primaryTextColor":"#111","primaryBorderColor":"#666","lineColor":"#666","fontFamily":"Inter, Arial, sans-serif","fontSize":"14px"},"flowchart": {"htmlLabels": false, "curve": "linear"},"accTitle": "ColdVox High-Level Architecture","accDescr": "Generated from repository evidence; dashed items are low-confidence inferences."}}%%
flowchart LR
  subgraph External
    USER([User/Client]):::external
    MIC[Microphone / OS Audio]:::external
  end

  subgraph App_Binaries
    APP[coldvox binary]:::core
    TUI[tui_dashboard]:::core
    PROBE[mic_probe]:::core
  end

  subgraph Core_Crates
    AUDIO[coldvox-audio]:::engine
    VAD[coldvox-vad silero]:::engine
    STT[coldvox-stt plugins]:::engine
    STT_VOSK[coldvox-stt-vosk ?]:::maybe
    INJECT[coldvox-text-injection ?]:::maybe
    TELEMETRY[coldvox-telemetry]:::obs
    FOUNDATION[coldvox-foundation]:::foundation
  end

  subgraph Runtime
    CAPTURE[AudioCaptureThread]:::core
  CHUNKER[AudioChunker 512_samples_16kHz]:::core
    VAD_PROC[VadProcessor]:::engine
    VAD_FANOUT[VAD Fanout]:::engine
  STT_PROC[STT Processor legacy_streaming]:::engine
  INJECT_PROC[Injection Processor ?]:::maybe
  end

  MIC -->|OS audio| CAPTURE
  USER -->|Hotkey| APP
  APP -->|spawns| CAPTURE
  CAPTURE -->|frames| CHUNKER -->|frames| VAD_PROC
  VAD_PROC -->|VadEvent| VAD_FANOUT -->|broadcast| APP
  VAD_FANOUT -->|stt events| STT_PROC
  CHUNKER -->|audio frames| STT_PROC
  STT_PROC -->|transcription events| APP
  STT_PROC -.->|metrics| TELEMETRY
  STT_PROC -->|plugin: vosk?| STT_VOSK
  STT_PROC -->|inject events| INJECT_PROC
  INJECT_PROC -.->|platform backends| INJECT
  FOUNDATION -.->|config & state| APP

  classDef external    fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0b2e6f;
  classDef core        fill:#ffe0b2,stroke:#e65100,stroke-width:2px,color:#4a2a00;
  classDef engine      fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#0b3012;
  classDef msg         fill:#d9f8ef,stroke:#006e5f,stroke-width:2px,color:#083a34;
  classDef sink        fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#2f0d3c;
  classDef ui          fill:#ede7f6,stroke:#5e35b1,stroke-width:2px,color:#221250;
  classDef foundation  fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#4a0b0b;
  classDef obs         fill:#eeeeee,stroke:#424242,stroke-width:2px,color:#111;
  classDef maybe       fill:#ffffff,stroke:#9e9e9e,stroke-dasharray:6 4,stroke-width:2px,color:#333;

  class USER,MIC external;
  class APP,TUI,PROBE core;
  class AUDIO,VAD,STT engine;
  class STT_VOSK,INJECT_PROC,INJECT maybe;
  class TELEMETRY obs;
  class FOUNDATION foundation;
