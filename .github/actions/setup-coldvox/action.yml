name: Setup ColdVox Dependencies
description: Install system deps, libvosk, and Rust toolchain
runs:
  using: composite
  steps:
    - name: Install system dependencies
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          libasound2-dev \
          libxdo-dev \
          libxtst-dev \
          wget \
          unzip \
          build-essential

    - name: Install libvosk (vendored)
      shell: bash
      run: |
        VOSK_VER=0.3.45
        unzip -q vendor/vosk/vosk-linux-x86_64-${VOSK_VER}.zip
        sudo cp -v vosk-linux-x86_64-${VOSK_VER}/libvosk.so /usr/local/lib/
        sudo cp -v vosk-linux-x86_64-${VOSK_VER}/vosk_api.h /usr/local/include/
        sudo ldconfig

    - name: Setup Rust toolchain
      uses: dtolnay/rust-toolchain@stable
      with:
        components: rustfmt, clippy

    - name: Cache Cargo
      uses: Swatinem/rust-cache@v2
